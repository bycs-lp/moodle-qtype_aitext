{"version":3,"file":"getSpellcheck.min.js","sources":["../src/getSpellcheck.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Generates the spellcheck diff view.\n *\n * @module     qtype_aitext/getSpellcheck\n * @copyright  2024, ISB Bayern\n * @author     Dr. Peter Mayer\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Diff from \"qtype_aitext/diff\";\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Init\n */\nexport const init = () => {\n    renderDiff();\n\n    if (!document.getElementById('aitext_spellcheckedit')) {\n        return;\n    }\n    document.getElementById('aitext_spellcheckedit').addEventListener(\"click\", showModalForm);\n};\n\n/**\n * Render the spellcheckdiff\n */\nexport const renderDiff = () => {\n    var studentanswer = document.getElementById('aitext_readonly_area').innerHTML,\n        spellcheck = document.getElementById('aitext_readonly_area').dataset.spellcheck,\n        span = null;\n\n    var diff = Diff.diffChars(studentanswer, spellcheck);\n    var fragment = document.createElement('div');\n\n    let fullspellcheck = '';\n\n    diff.forEach(function (part) {\n        var cls = part.added ? 'qtype_aitext_spellcheck_new' :\n            part.removed ? 'qtype_aitext_spellcheck_wrong' : '';\n        if (part.added || part.removed) {\n            span = document.createElement('span');\n            span.classList = cls;\n            span.appendChild(document.createTextNode(part.value));\n            fullspellcheck += span.outerHTML;\n        } else {\n            fullspellcheck += part.value;\n        }\n    });\n\n    fragment.innerHTML = fullspellcheck;\n    document.getElementById('aitext_readonly_area').replaceChildren(fragment);\n};\n\n/**\n * Show the dynamic spellcheck form.\n */\nexport const showModalForm = () => {\n    const attemptstepid = document.getElementById('aitext_readonly_area').dataset.spellcheckattemptstepid;\n    const answerstepid = document.getElementById('aitext_readonly_area').dataset.spellcheckattemptstepanswerid;\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    const modalForm = new ModalForm({\n        formClass: \"qtype_aitext\\\\form\\\\edit_spellchek\",\n        args: {\n            attemptstepid: attemptstepid,\n            answerstepid: answerstepid,\n            cmid: urlParams.get('cmid'),\n        },\n        modalConfig: { title: getString('spellcheckedit', 'qtype_aitext') },\n    });\n    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, reloadpage);\n    modalForm.show();\n};\n\n/**\n * Reload the page. This is not nice, but easy :-)\n */\nconst reloadpage = () => {\n    location.reload();\n}\n"],"names":["renderDiff","document","getElementById","addEventListener","showModalForm","studentanswer","innerHTML","spellcheck","dataset","span","diff","Diff","diffChars","fragment","createElement","fullspellcheck","forEach","part","cls","added","removed","classList","appendChild","createTextNode","value","outerHTML","replaceChildren","attemptstepid","spellcheckattemptstepid","answerstepid","spellcheckattemptstepanswerid","queryString","window","location","search","urlParams","URLSearchParams","modalForm","ModalForm","formClass","args","cmid","get","modalConfig","title","events","FORM_SUBMITTED","reloadpage","show","reload"],"mappings":";;;;;;;;wFA+BoB,KAChBA,aAEKC,SAASC,eAAe,0BAG7BD,SAASC,eAAe,yBAAyBC,iBAAiB,QAASC,sBAMlEJ,WAAa,SAClBK,cAAgBJ,SAASC,eAAe,wBAAwBI,UAChEC,WAAaN,SAASC,eAAe,wBAAwBM,QAAQD,WACrEE,KAAO,KAEPC,KAAOC,KAAKC,UAAUP,cAAeE,YACrCM,SAAWZ,SAASa,cAAc,WAElCC,eAAiB,GAErBL,KAAKM,SAAQ,SAAUC,UACfC,IAAMD,KAAKE,MAAQ,8BACnBF,KAAKG,QAAU,gCAAkC,GACjDH,KAAKE,OAASF,KAAKG,UACnBX,KAAOR,SAASa,cAAc,SACzBO,UAAYH,IACjBT,KAAKa,YAAYrB,SAASsB,eAAeN,KAAKO,QAC9CT,gBAAkBN,KAAKgB,WAEvBV,gBAAkBE,KAAKO,SAI/BX,SAASP,UAAYS,eACrBd,SAASC,eAAe,wBAAwBwB,gBAAgBb,gDAMvDT,cAAgB,WACnBuB,cAAgB1B,SAASC,eAAe,wBAAwBM,QAAQoB,wBACxEC,aAAe5B,SAASC,eAAe,wBAAwBM,QAAQsB,8BACvEC,YAAcC,OAAOC,SAASC,OAC9BC,UAAY,IAAIC,gBAAgBL,aAChCM,UAAY,IAAIC,mBAAU,CAC5BC,UAAW,qCACXC,KAAM,CACFb,cAAeA,cACfE,aAAcA,aACdY,KAAMN,UAAUO,IAAI,SAExBC,YAAa,CAAEC,OAAO,mBAAU,iBAAkB,mBAEtDP,UAAUlC,iBAAiBkC,UAAUQ,OAAOC,eAAgBC,YAC5DV,UAAUW,mDAMRD,WAAa,KACfd,SAASgB"}